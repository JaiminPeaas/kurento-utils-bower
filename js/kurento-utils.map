{"version":3,"file":"bundle.js","sources":["../node_modules/browserify/node_modules/browser-pack/_prelude.js","../lib/index.js","../lib/WebRtcPeer.js"],"names":["WebRtcPeer","require","exports","defaultOnerror","error","console","noop","mode","localVideo","remoteVideo","onsdpoffer","onerror","videoStream","Object","defineProperty","this","writable","stream","prototype","start","self","pc","RTCPeerConnection","server","options","src","URL","createObjectURL","muted","addStream","constraints","mandatory","OfferToReceiveAudio","undefined","OfferToReceiveVideo","createOffer","offer","log","setLocalDescription","onicecandidate","e","candidate","offerSdp","localDescription","sdp","dispose","close","getAudioTracks","forEach","track","stop","getVideoTracks","userMediaConstraints","audio","video","maxWidth","maxFrameRate","minFrameRate","processSdpAnswer","sdpAnswer","answer","RTCSessionDescription","type","setRemoteDescription","getRemoteStreams","iceServers","url","optional","DtlsSrtpKeyAgreement","onSdp","mediaConstraints","wp","getUserMedia","userStream","startRecvOnly","onError","startSendOnly","startSendRecv","module"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the GNU Lesser General Public License\n * (LGPL) version 2.1 which accompanies this distribution, and is available at\n * http://www.gnu.org/licenses/lgpl-2.1.html\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n */\n\n/**\n * This module contains a set of reusable components that have been found useful\n * during the development of the WebRTC applications with Kurento.\n * \n * @module kurentoUtils\n * \n * @copyright 2014 Kurento (http://kurento.org/)\n * @license LGPL\n */\n\nvar WebRtcPeer = require('./WebRtcPeer');\n\nexports.WebRtcPeer = WebRtcPeer;\n","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the GNU Lesser General Public License\n * (LGPL) version 2.1 which accompanies this distribution, and is available at\n * http://www.gnu.org/licenses/lgpl-2.1.html\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n */\n\n/**\n * @description Default handler for error callbacks. The error messaged passed\n *              as argument is showed in a console, a div layer which should be\n *              previously created.\n * \n * @function defaultOnerror\n * \n * @param error -\n *            {String} Error message\n * \n */\nfunction defaultOnerror(error) {\n\tif (error)\n\t\tconsole.error(error);\n}\n\nfunction noop() {\n};\n\n/**\n * \n * @classdesc Wrapper object of an RTCPeerConnection. This object is aimed to\n *            simplify the development of WebRTC-based applications.\n * \n * @constructor module:kurentoUtils.WebRtcPeer\n * \n * @param mode -\n *            {String} Mode in which the PeerConnection will be configured.\n *            Valid values are: 'recv', 'send', and 'sendRecv'\n * @param localVideo -\n *            {Object} Video tag for the local stream\n * @param remoteVideo -\n *            {Object} Video tag for the remote stream\n * @param onsdpoffer -\n *            {Function} Callback executed when a SDP offer has been generated\n * @param onerror -\n *            {Function} Callback executed when an error happens generating an\n *            SDP offer\n * @param videoStream -\n *            {Object} MediaStream to be used as source for localVideo and to be\n *            added as stream to the RTCPeerConnection\n * \n */\nfunction WebRtcPeer(mode, localVideo, remoteVideo, onsdpoffer, onerror,\n\t\tvideoStream) {\n\n\tObject.defineProperty(this, 'pc', {\n\t\twritable : true\n\t});\n\n\tthis.localVideo = localVideo;\n\tthis.remoteVideo = remoteVideo;\n\tthis.onerror = onerror || defaultOnerror;\n\tthis.stream = videoStream;\n\tthis.mode = mode;\n\tthis.onsdpoffer = onsdpoffer || noop;\n}\n\n/**\n * @description This method creates the RTCPeerConnection object taking into\n *              account the properties received in the constructor. It starts\n *              the SDP negotiation process: generates the SDP offer and invokes\n *              the onsdpoffer callback. This callback is expected to send the\n *              SDP offer, in order to obtain an SDP answer from another peer.\n * \n * @function module:kurentoUtils.WebRtcPeer.prototype.start\n * \n */\nWebRtcPeer.prototype.start = function() {\n\n\tvar self = this;\n\n\tif (!this.pc) {\n\t\tthis.pc = new RTCPeerConnection(this.server, this.options);\n\t}\n\n\tvar pc = this.pc;\n\n\tif (this.stream && this.localVideo) {\n\t\tthis.localVideo.src = URL.createObjectURL(this.stream);\n\t\tthis.localVideo.muted = true;\n\t}\n\n\tif (this.stream) {\n\t\tpc.addStream(this.stream);\n\t}\n\n\tthis.constraints = {\n\t\tmandatory : {\n\t\t\tOfferToReceiveAudio : (this.remoteVideo !== undefined),\n\t\t\tOfferToReceiveVideo : (this.remoteVideo !== undefined)\n\t\t}\n\t};\n\n\tpc.createOffer(function(offer) {\n\t\tconsole.log('Created SDP offer');\n\t\tpc.setLocalDescription(offer, function() {\n\t\t\tconsole.log('Local description set');\n\t\t}, self.onerror);\n\n\t}, this.onerror, this.constraints);\n\n\tpc.onicecandidate = function(e) {\n\t\t// candidate exists in e.candidate\n\t\tif (e.candidate)\n\t\t\treturn;\n\n\t\tvar offerSdp = pc.localDescription.sdp;\n\t\tconsole.log('ICE negotiation completed');\n\n\t\tself.onsdpoffer(offerSdp, self);\n\t\t// self.emit('sdpoffer', offerSdp);\n\t};\n\n}\n\n/**\n * @description This method frees the resources used by WebRtcPeer.\n * \n * @function module:kurentoUtils.WebRtcPeer.prototype.dispose\n * \n */\nWebRtcPeer.prototype.dispose = function() {\n\tconsole.log('Disposing WebRtcPeer');\n\n\t// FIXME This is not yet implemented in firefox\n\t// if (this.stream) this.pc.removeStream(this.stream);\n\tif (this.pc)\n\t\tthis.pc.close();\n\n\tif (this.localVideo)\n\t\tthis.localVideo.src = '';\n\tif (this.remoteVideo)\n\t\tthis.remoteVideo.src = '';\n\n\tif (this.stream) {\n\t\tthis.stream.getAudioTracks().forEach(function(track) {\n\t\t\ttrack.stop()\n\t\t})\n\t\tthis.stream.getVideoTracks().forEach(function(track) {\n\t\t\ttrack.stop()\n\t\t})\n\t}\n};\n\n/**\n * @description Default user media constraints considered when invoking the\n *              getUserMedia function. These values are: maxWidth=640,\n *              maxFrameRate=15, minFrameRate=15.\n * \n * @alias module:kurentoUtils.WebRtcPeer.prototype.userMediaConstraints\n * \n */\nWebRtcPeer.prototype.userMediaConstraints = {\n\taudio : true,\n\tvideo : {\n\t\tmandatory : {\n\t\t\tmaxWidth : 640,\n\t\t\tmaxFrameRate : 15,\n\t\t\tminFrameRate : 15\n\t\t}\n\t}\n};\n\n/**\n * @description Callback function invoked when and SDP answer is received.\n *              Developers are expected to invoke this function in order to\n *              complete the SDP negotiation.\n * \n * @function module:kurentoUtils.WebRtcPeer.prototype.processSdpAnswer\n * \n * @param sdpAnswer -\n *            Description of sdpAnswer\n * \n */\nWebRtcPeer.prototype.processSdpAnswer = function(sdpAnswer) {\n\tvar answer = new RTCSessionDescription({\n\t\ttype : 'answer',\n\t\tsdp : sdpAnswer,\n\t});\n\n\tconsole.log('SDP answer received, setting remote description');\n\tvar self = this;\n\tself.pc.setRemoteDescription(answer, function() {\n\t\tif (self.remoteVideo) {\n\t\t\tvar stream = self.pc.getRemoteStreams()[0];\n\t\t\tself.remoteVideo.src = URL.createObjectURL(stream);\n\t\t}\n\t}, this.onerror);\n}\n\n/**\n * @description Default ICE server (stun:stun.l.google.com:19302).\n * \n * @alias module:kurentoUtils.WebRtcPeer.prototype.server\n * \n */\nWebRtcPeer.prototype.server = {\n\ticeServers : [ {\n\t\turl : 'stun:stun.l.google.com:19302'\n\t} ]\n};\n\n/**\n * @description Default options (DtlsSrtpKeyAgreement=true) for\n *              RTCPeerConnection.\n * \n * @alias module:kurentoUtils.WebRtcPeer.prototype.options\n * \n */\nWebRtcPeer.prototype.options = {\n\toptional : [ {\n\t\tDtlsSrtpKeyAgreement : true\n\t} ]\n};\n\n/**\n * @description This method creates the WebRtcPeer object and obtain userMedia\n *              if needed.\n * \n * @function module:kurentoUtils.WebRtcPeer.start\n * \n * @param mode -\n *            {String} Mode in which the PeerConnection will be configured.\n *            Valid values are: 'recv', 'send', and 'sendRecv'\n * @param localVideo -\n *            {Object} Video tag for the local stream\n * @param remoteVideo -\n *            {Object} Video tag for the remote stream\n * @param onSdp -\n *            {Function} Callback executed when a SDP offer has been generated\n * @param onerror -\n *            {Function} Callback executed when an error happens generating an\n *            SDP offer\n * @param mediaConstraints -\n *            {Object[]} Constraints used to create RTCPeerConnection\n * @param videoStream -\n *            {Object} MediaStream to be used as source for localVideo and to be\n *            added as stream to the RTCPeerConnection\n * \n * @return {module:kurentoUtils.WebRtcPeer}\n */\nWebRtcPeer.start = function(mode, localVideo, remoteVideo, onSdp, onerror,\n\t\tmediaConstraints, videoStream) {\n\tvar wp = new WebRtcPeer(mode, localVideo, remoteVideo, onSdp, onerror,\n\t\t\tvideoStream);\n\n\tif (wp.mode !== 'recv' && !wp.stream) {\n\t\tvar constraints = mediaConstraints ? mediaConstraints\n\t\t\t\t: wp.userMediaConstraints;\n\n\t\tgetUserMedia(constraints, function(userStream) {\n\t\t\twp.stream = userStream;\n\t\t\twp.start();\n\t\t}, wp.onerror);\n\t} else {\n\t\twp.start();\n\t}\n\n\treturn wp;\n};\n\n/**\n * @description This methods creates a WebRtcPeer to receive video.\n * \n * @function module:kurentoUtils.WebRtcPeer.startRecvOnly\n * \n * @param remoteVideo -\n *            {Object} Video tag for the remote stream\n * @param onSdp -\n *            {Function} Callback executed when a SDP offer has been generated\n * @param onerror -\n *            {Function} Callback executed when an error happens generating an\n *            SDP offer\n * @param mediaConstraints -\n *            {Object[]} Constraints used to create RTCPeerConnection\n * \n * @return {module:kurentoUtils.WebRtcPeer}\n */\nWebRtcPeer.startRecvOnly = function(remoteVideo, onSdp, onError,\n\t\tmediaConstraints) {\n\treturn WebRtcPeer.start('recv', null, remoteVideo, onSdp, onError,\n\t\t\tmediaConstraints);\n};\n\n/**\n * @description This methods creates a WebRtcPeer to send video.\n * \n * @function module:kurentoUtils.WebRtcPeer.startSendOnly\n * \n * @param localVideo -\n *            {Object} Video tag for the local stream\n * @param onSdp -\n *            {Function} Callback executed when a SDP offer has been generated\n * @param onerror -\n *            {Function} Callback executed when an error happens generating an\n *            SDP offer\n * @param mediaConstraints -\n *            {Object[]} Constraints used to create RTCPeerConnection\n * \n * @return {module:kurentoUtils.WebRtcPeer}\n */\nWebRtcPeer.startSendOnly = function(localVideo, onSdp, onError,\n\t\tmediaConstraints) {\n\treturn WebRtcPeer.start('send', localVideo, null, onSdp, onError,\n\t\t\tmediaConstraints);\n};\n\n/**\n * @description This methods creates a WebRtcPeer to send and receive video.\n * \n * @function module:kurentoUtils.WebRtcPeer.startSendRecv\n * \n * @param localVideo -\n *            {Object} Video tag for the local stream\n * @param remoteVideo -\n *            {Object} Video tag for the remote stream\n * @param onSdp -\n *            {Function} Callback executed when a SDP offer has been generated\n * @param onerror -\n *            {Function} Callback executed when an error happens generating an\n *            SDP offer\n * @param mediaConstraints -\n *            {Object[]} Constraints used to create RTCPeerConnection\n * \n * @return {module:kurentoUtils.WebRtcPeer}\n */\nWebRtcPeer.startSendRecv = function(localVideo, remoteVideo, onSdp, onError,\n\t\tmediaConstraints) {\n\treturn WebRtcPeer.start('sendRecv', localVideo, remoteVideo, onSdp,\n\t\t\tonError, mediaConstraints);\n};\n\nmodule.exports = WebRtcPeer;\n"]}