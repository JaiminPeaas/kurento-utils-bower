!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.kurentoUtils=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function noop(e){e&&console.trace(e)}function trackStop(e){e.stop&&e.stop()}function streamStop(e){e.getTracks().forEach(trackStop)}function WebRtcPeer(e,t,n){function r(e,t,n){return e?console.error(e):void R.processSdpAnswer(t,n)}WebRtcPeer.super_.call(this);for(var o,c,i,s,a,l,d,u;arguments.length&&!arguments[arguments.length-1];)arguments.length--;arguments.length>2?(console.warn("Positional parameters are deprecated for WebRtcPeer"),o=arguments[1],c=arguments[2],i=arguments[3],s=arguments[4],a=arguments[5],l=arguments[6],d=arguments[7]):(o=t.localVideo,c=t.remoteVideo,i=t.onsdpoffer,s=t.onerror,a=t.mediaConstraints,l=t.videoStream,d=t.audioStream,u=t.connectionConstraints),s&&this.on("error",s),i&&this.on("sdpoffer",i);var f=t.peerConnection;if(!f){var p=recursive({iceServers:freeice()},WebRtcPeer.prototype.server,t.configuration);f=new RTCPeerConnection(p)}Object.defineProperty(this,"peerConnection",{get:function(){return f}});var R=this,b=!1;f.addEventListener("icecandidate",function(e){return e.candidate?void(b=!1):void(b||(b=!0,R.emit("sdpoffer",f.localDescription.sdp,r),console.log("ICE negotiation completed")))}),this.start=function(t,n){if(l&&o&&(o.src=URL.createObjectURL(l),o.muted=!0),l&&f.addStream(l),d&&f.addStream(d),t instanceof Function){if(n)throw new Error("Nothing can be defined after the callback");n=t,t=void 0}"sendonly"==e&&(e="sendrecv"),t=recursive({mandatory:{OfferToReceiveAudio:"sendonly"!==e,OfferToReceiveVideo:"sendonly"!==e},optional:[{DtlsSrtpKeyAgreement:!0}]},t),n=n||noop,f.createOffer(function(e){console.log("Created SDP offer"),f.setLocalDescription(e,function(){console.log("Local description set",e),n(null,R)},n)},n,t)},"recvonly"===e||l?R.start(t.connectionConstraints,n):(a=recursive({audio:!0,video:{mandatory:{maxWidth:640,maxFrameRate:15,minFrameRate:15}}},a),getUserMedia(a,function(e){l=e,R.start(t.connectionConstraints,n)},n||noop)),this.on("_dispose",function(){o&&(o.src=""),c&&(c.src="")}),this.on("_processSdpAnswer",function(e){c&&(c.src=e,console.log("Remote URL:",e))})}function WebRtcPeerRecvonly(e){WebRtcPeerRecvonly.super_.call(this,"recvonly",e)}function WebRtcPeerSendonly(e){WebRtcPeerSendonly.super_.call(this,"sendonly",e)}function WebRtcPeerSendrecv(e){WebRtcPeerSendrecv.super_.call(this,"sendrecv",e)}var freeice=require("freeice"),inherits=require("inherits"),EventEmitter=require("events").EventEmitter,recursive=require("merge").recursive;inherits(WebRtcPeer,EventEmitter),WebRtcPeer.prototype.server={},WebRtcPeer.prototype.getLocalStream=function(e){return this.peerConnection?this.peerConnection.getLocalStreams()[e||0]:void 0},WebRtcPeer.prototype.getRemoteStream=function(e){return this.peerConnection?this.peerConnection.getRemoteStreams()[e||0]:void 0},WebRtcPeer.prototype.dispose=function(){console.log("Disposing WebRtcPeer");var e=this.peerConnection;e&&("closed"!=e.signalingState&&e.close(),e.getLocalStreams().forEach(streamStop)),this.emit("_dispose")},WebRtcPeer.prototype.processSdpAnswer=function(e,t){var n=new RTCSessionDescription({type:"answer",sdp:e});console.log("SDP answer received, setting remote description"),t=t||noop;var r=this,o=this.peerConnection;o.setRemoteDescription(n,function(){var e=URL.createObjectURL(o.getRemoteStreams()[0]);r.emit("_processSdpAnswer",e),t()},t)},Object.defineProperty(WebRtcPeer.prototype,"enabled",{enumerable:!0,get:function(){return this.audioEnabled&&this.videoEnabled},set:function(e){this.audioEnabled=this.videoEnabled=e}}),Object.defineProperty(WebRtcPeer.prototype,"audioEnabled",{enumerable:!0,get:function(){if(this.peerConnection){var e=this.peerConnection.getLocalStreams();if(e.length){for(var t,n=0;t=e[n];n++)for(var r,o=0;r=t.getAudioTracks()[o];o++)if(!r.enabled)return!1;return!0}}},set:function(e){this.peerConnection.getLocalStreams().forEach(function(t){t.getAudioTracks().forEach(function(t){t.enabled=e})})}}),Object.defineProperty(WebRtcPeer.prototype,"videoEnabled",{enumerable:!0,get:function(){if(this.peerConnection){var e=this.peerConnection.getLocalStreams();if(e.length){for(var t,n=0;t=e[n];n++)for(var r,o=0;r=t.getVideoTracks()[o];o++)if(!r.enabled)return!1;return!0}}},set:function(e){this.peerConnection.getLocalStreams().forEach(function(t){t.getVideoTracks().forEach(function(t){t.enabled=e})})}}),WebRtcPeer.start=function(e,t,n,r,o,c,i,s,a,l,d){var u={localVideo:t,remoteVideo:n,onsdpoffer:r,onerror:o,mediaConstraints:c,videoStream:i,audioStream:s,configuration:a,connectionConstraints:l};return new WebRtcPeer(e,u,d)},WebRtcPeer.startRecvOnly=function(e,t,n,r,o,c,i){return WebRtcPeer.start("recvonly",null,e,t,n,r,null,null,o,c,i)},WebRtcPeer.startSendOnly=function(e,t,n,r,o,c,i){return WebRtcPeer.start("sendonly",e,null,t,n,r,null,null,o,c,i)},WebRtcPeer.startSendRecv=function(e,t,n,r,o,c,i,s){return WebRtcPeer.start("sendrecv",e,t,n,r,o,null,null,c,i,s)},inherits(WebRtcPeerRecvonly,WebRtcPeer),inherits(WebRtcPeerSendonly,WebRtcPeer),inherits(WebRtcPeerSendrecv,WebRtcPeer),module.exports=WebRtcPeer,WebRtcPeer.WebRtcPeer=WebRtcPeer,WebRtcPeer.WebRtcPeerRecvonly=WebRtcPeerRecvonly,WebRtcPeer.WebRtcPeerSendonly=WebRtcPeerSendonly,WebRtcPeer.WebRtcPeerSendrecv=WebRtcPeerSendrecv;
},{"events":7,"freeice":3,"inherits":8,"merge":9}],2:[function(require,module,exports){
var WebRtcPeer=require("./WebRtcPeer");exports.WebRtcPeer=WebRtcPeer;
},{"./WebRtcPeer":1}],3:[function(require,module,exports){
"use strict";var normalice=require("normalice"),freeice=module.exports=function(n){function t(n,t){for(var r,e=[],o=[].concat(u[n]);o.length&&e.length<t;)r=Math.random()*o.length|0,e=e.concat(o.splice(r,1));return e.map(function(t){return normalice(n+":"+t)})}var r,u={stun:(n||{}).stun||require("./stun.json"),turn:(n||{}).turn||require("./turn.json")},e=(n||{}).stunCount||2,o=(n||{}).turnCount||0;return r=[].concat(t("stun",e)),o&&(r=r.concat(t("turn",o))),r};
},{"./stun.json":5,"./turn.json":6,"normalice":4}],4:[function(require,module,exports){
var protocols=["stun:","turn:"];module.exports=function(e){var r,t,n=(e||{}).url||e,l={};return"string"==typeof n||n instanceof String?(n=n.trim(),(r=protocols[protocols.indexOf(n.slice(0,5))])?(n=n.slice(5),t=n.split("@"),l.username=e.username,l.credential=e.credential,t.length>1&&(n=t[1],t=t[0].split(":"),l.username=t[0],l.credential=(e||{}).credential||t[1]||""),l.url=r+n,l.urls=[l.url],l):e):e};
},{}],5:[function(require,module,exports){
module.exports=[
  "stun.l.google.com:19302",
  "stun1.l.google.com:19302",
  "stun2.l.google.com:19302",
  "stun3.l.google.com:19302",
  "stun4.l.google.com:19302",
  "stun.ekiga.net",
  "stun.ideasip.com",
  "stun.rixtelecom.se",
  "stun.schlund.de",
  "stun.stunprotocol.org:3478",
  "stun.voiparound.com",
  "stun.voipbuster.com",
  "stun.voipstunt.com",
  "stun.voxgratia.org",
  "stun.services.mozilla.com"
]

},{}],6:[function(require,module,exports){
module.exports=[]

},{}],7:[function(require,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,s,i,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];n.apply(this,i)}else if(isObject(n)){for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];for(o=n.slice(),s=o.length,r=0;s>r;r++)o[r].apply(this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned){var n;n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var s=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,s,i,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,s=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(n)){for(r=i;r-->0;)if(n[r]===t||n[r].listener&&n[r].listener===t){s=r;break}if(0>s)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0};
},{}],8:[function(require,module,exports){
module.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};
},{}],9:[function(require,module,exports){
!function(e){function r(e,o){if("object"!==n(e))return o;for(var t in o)e[t]="object"===n(e[t])&&"object"===n(o[t])?r(e[t],o[t]):o[t];return e}function o(e,o,c){var u=c[0],f=c.length;(e||"object"!==n(u))&&(u={});for(var i=0;f>i;++i){var l=c[i],a=n(l);if("object"===a)for(var s in l){var v=e?t.clone(l[s]):l[s];u[s]=o?r(u[s],v):v}}return u}function n(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var t=function(e){return o(e===!0,!1,arguments)},c="merge";t.recursive=function(e){return o(e===!0,!0,arguments)},t.clone=function(e){var r,o,c=e,u=n(e);if("array"===u)for(c=[],o=e.length,r=0;o>r;++r)c[r]=t.clone(e[r]);else if("object"===u){c={};for(r in e)c[r]=t.clone(e[r])}return c},e?module.exports=t:window[c]=t}("object"==typeof module&&module&&"object"==typeof module.exports&&module.exports);
},{}]},{},[2])(2)
});


//# sourceMappingURL=kurento-utils.map